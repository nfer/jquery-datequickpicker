/*
 *  jquery-datequickpicker - v0.1.0
 *  A Date Quick Picker jQuery plugin.
 *  https://github.com/nfer/jquery-datequickpicker
 *
 *  Made by Nfer Zhuang
 *  Under MIT License
 */
!function(a,b,c,d){"use strict";function e(b,c){this.element=b,this.settings=a.extend({},g,c),this._defaults=g,this._name=f,this.init()}var f="datequickpicker",g={onRadioClicked:null,onSelectChanged:null};a.extend(e.prototype,{init:function(){this.initPickerHtml(),this.initSelectOption(),this.initEventHandler(),this.doStartAction()},initPickerHtml:function(){var b="<div class='datequickpicker-content'><div class='select select-success' style='display:inline'><select class='dqp-year p-l-5 p-r-5'></select><select class='dqp-month p-l-5 p-r-5'></select><select class='dqp-day p-l-5 p-r-5'></select><select class='dqp-week p-l-5 p-r-5'></select></div><div class='radio radio-success m-l-20' style='display:inline'><input type='radio' name='dqp-radio' value='today' id='dqp-today' checked='checked'><label for='dqp-today'>今日</label><input type='radio' name='dqp-radio' value='yesterday' id='dqp-yesterday'><label for='dqp-yesterday'>昨日</label><input type='radio' name='dqp-radio' value='curWeek' id='dqp-cur-week'><label for='dqp-cur-week'>本周</label><input type='radio' name='dqp-radio' value='curMonth' id='dqp-cur-month'><label for='dqp-cur-month'>本月</label></div></div>";a(this.element).html(b)},initSelectOption:function(){for(var b=new Date,c=b.getFullYear(),d=b.getMonth()+1,e=b.getDate(),f=this.getWeeksInYear(b),g="",h=2016;h<=c;h++)g+=h===c?"<option name='dqp-year' value='"+h+"' selected='selected'>"+h+"</option>":"<option name='dqp-year' value='"+h+"'>"+h+"</option>";a(this.element).find("select.dqp-year").append(g);for(var i="",j=1;j<=12;j++)i+=j===d?"<option name='dqp-month' value='"+j+"' selected='selected'>"+j+"月</option>":"<option name='dqp-month' value='"+j+"'>"+j+"月</option>";a(this.element).find("select.dqp-month").append(i);for(var k="",l=this.getDaysInMonth(c,d),m=1;m<=l;m++)k+=m===e?"<option name='dqp-day' value='"+m+"' selected='selected'>"+m+"号</option>":"<option name='dqp-day' value='"+m+"'>"+m+"号</option>";a(this.element).find("select.dqp-day").append(k);for(var n="",o=1;o<=54;o++)n+=o===f?"<option name='dqp-week' value='"+o+"' selected='selected'>"+o+"周</option>":"<option name='dqp-week' value='"+o+"'>"+o+"周</option>";a(this.element).find("select.dqp-week").append(n)},initEventHandler:function(){var b=this;a(this.element).on("click","input[name='dqp-radio']",function(){b.onRadioClickedHandler()}),a(this.element).on("change","select",function(){b.onSelectChangedHandler()})},doStartAction:function(){a(this.element).find("input[name='dqp-radio']:first").click()},onRadioClickedHandler:function(){var b=a(this.element).find("input[name='dqp-radio']:checked").val(),c=1,d=0,e=new Date,f=e.getFullYear(),g=e.getMonth()+1,h=e.getDate(),i=this.getWeeksInYear(e),j=a(this.element).find("div.select");switch(j.children().removeClass("hidden"),b){case"today":j.children(".dqp-year").val(f),j.children(".dqp-month").val(g),j.children(".dqp-day").val(h),j.children(".dqp-week").addClass("hidden"),c=1,d=0;break;case"yesterday":j.children(".dqp-year").val(f),j.children(".dqp-month").val(g),j.children(".dqp-day").val(h-1),j.children(".dqp-week").addClass("hidden"),c=2,d=1;break;case"curWeek":j.children(".dqp-year").val(f),j.children(".dqp-week").val(i),j.children(".dqp-month").addClass("hidden"),j.children(".dqp-day").addClass("hidden"),c=h,d=0;break;case"curMonth":j.children(".dqp-year").val(f),j.children(".dqp-month").val(g),j.children(".dqp-day").addClass("hidden"),j.children(".dqp-week").addClass("hidden"),c=h,d=0}this.settings.onRadioClicked&&this.settings.onRadioClicked(c,d)},onSelectChangedHandler:function(){var b,c,d,e,f=a(this.element).find("div.select"),g=f.children(".dqp-week").is(":visible"),h=f.children(".dqp-day").is(":visible"),i=f.children(".dqp-year").val(),j=f.children(".dqp-week").val(),k=f.children(".dqp-month").val()-1,l=f.children(".dqp-day").val(),m=new Date;if(g){var n=this.getWeeksStartDate(i,j);b=Math.ceil((m-n)/864e5)-1,d=b+1,e=b-6,e=e>0?e:0}else if(h){var o=new Date(i,k,l);if(o>m)return void alert("选择的日期已超过今天");b=Math.ceil((m-o)/864e5)-1,d=b+1,e=b}else{if(i===m.getFullYear()&&k>m.getMonth())return void alert("选择的月份已超过本月");var p=new Date(i,k,1),q=new Date(i,k+1,0);startDayBeforeToday=Math.ceil((m-p)/864e5)-1,c=Math.ceil((m-q)/864e5)-1,d=startDayBeforeToday+1,e=c>0?c:0}this.settings.onSelectChanged&&this.settings.onSelectChanged(d,e)},getDaysInMonth:function(a,b){var c=new Date(a,b,0);return c.getDate()},getWeeksInYear:function(a){var b=new Date(a.getFullYear(),0,1);return Math.ceil(((a-b)/864e5+b.getDay()+1)/7)},getWeeksStartDate:function(a,b){var c=new Date(a,0,1);return c.getTime()+7*(b-1)*864e5-864e5*(c.getDay()-1)}}),a.fn[f]=function(b){return this.each(function(){a.data(this,"plugin_"+f)||a.data(this,"plugin_"+f,new e(this,b))})}}(jQuery,window,document);