/*
 *  jquery-datequickpicker - v0.1.0
 *  A Date Quick Picker jQuery plugin.
 *  https://github.com/nfer/jquery-datequickpicker
 *
 *  Made by Nfer Zhuang
 *  Under MIT License
 */
!function(a,b,c,d){"use strict";function e(b,c){this.element=b,this.settings=a.extend({},g,c),this._defaults=g,this._name=f,this.init()}var f="datequickpicker",g={onRadioClicked:null,onSelectChanged:null};a.extend(e.prototype,{init:function(){this.initPickerHtml(),this.initSelectOption(),this.initEventHandler(),this.doStartAction()},initPickerHtml:function(){var b="<div class='radio radio-success'><select class='dqp-select dqp-year p-l-5 p-r-5'></select><select class='dqp-select dqp-month p-l-5 p-r-5'></select><select class='dqp-select dqp-day p-l-5 p-r-5'></select><select class='dqp-select dqp-week p-l-5 p-r-5'></select><span class='hidde m-l-10 m-r-10'></span><input type='radio' name='dqp-radio' value='today' id='today'><label for='today'>今日</label><input type='radio' name='dqp-radio' value='yesterday' id='yesterday'><label for='yesterday'>昨日</label><input type='radio' name='dqp-radio' value='cur_week' id='cur_week'><label for='cur_week'>本周</label><input type='radio' name='dqp-radio' value='cur_month' id='cur_month'><label for='cur_month'>本月</label></div>";a(this.element).html(b)},initSelectOption:function(){for(var b=new Date,c=b.getFullYear(),d=b.getMonth()+1,e=b.getDate(),f=this.getWeeksInYear(b),g="",h=2016;h<=c;h++)g+=h===c?"<option name='dqp-year' value='"+h+"' selected='selected'>"+h+"</option>":"<option name='dqp-year' value='"+h+"'>"+h+"</option>";a("select.dqp-year").append(g);for(var i="",j=1;j<=12;j++)i+=j===d?"<option name='dqp-month' value='"+j+"' selected='selected'>"+j+"月</option>":"<option name='dqp-month' value='"+j+"'>"+j+"月</option>";a("select.dqp-month").append(i);for(var k="",l=this.getDaysInMonth(c,d),m=1;m<=l;m++)k+=m===e?"<option name='dqp-day' value='"+m+"' selected='selected'>"+m+"号</option>":"<option name='dqp-day' value='"+m+"'>"+m+"号</option>";a("select.dqp-day").append(k);for(var n="",o=1;o<=54;o++)n+=o===f?"<option name='dqp-week' value='"+o+"' selected='selected'>"+o+"周</option>":"<option name='dqp-week' value='"+o+"'>"+o+"周</option>";a("select.dqp-week").append(n)},initEventHandler:function(){var b=this;a(this.element).on("click","input[name='dqp-radio']",function(){b.onRadioClickedHandler()}),a(this.element).on("change","select.dqp-select",function(){b.onSelectChangedHandler()})},doStartAction:function(){a("input[name='dqp-radio']:first").click()},onRadioClickedHandler:function(){var b=a("input[name='dqp-radio']:checked").val(),c=1,d=0,e=new Date,f=e.getFullYear(),g=e.getMonth()+1,h=e.getDate(),i=this.getWeeksInYear(e);switch(a("select.dqp-select").removeClass("hidden"),b){case"today":a("select.dqp-year").val(f),a("select.dqp-month").val(g),a("select.dqp-day").val(h),a("select.dqp-week").addClass("hidden"),c=1,d=0;break;case"yesterday":a("select.dqp-year").val(f),a("select.dqp-month").val(g),a("select.dqp-day").val(h-1),a("select.dqp-week").addClass("hidden"),c=2,d=1;break;case"cur_week":a("select.dqp-year").val(f),a("select.dqp-week").val(i),a("select.dqp-month").addClass("hidden"),a("select.dqp-day").addClass("hidden"),c=h,d=0;break;case"cur_month":a("select.dqp-year").val(f),a("select.dqp-month").val(g),a("select.dqp-day").addClass("hidden"),a("select.dqp-week").addClass("hidden"),c=h,d=0}this.settings.onRadioClicked&&this.settings.onRadioClicked(c,d)},onSelectChangedHandler:function(){var b,c,d,e,f=a("select.dqp-week").is(":visible"),g=a("select.dqp-day").is(":visible"),h=a("select.dqp-year").val(),i=a("select.dqp-week").val(),j=a("select.dqp-month").val()-1,k=a("select.dqp-day").val(),l=new Date;if(f){var m=this.getWeeksStartDate(h,i);b=Math.ceil((l-m)/864e5)-1,d=b+1,e=b-6,e=e>0?e:0}else if(g){var n=new Date(h,j,k);if(n>l)return void alert("选择的日期已超过今天");b=Math.ceil((l-n)/864e5)-1,d=b+1,e=b}else{if(h===l.getFullYear()&&j>l.getMonth())return void alert("选择的月份已超过本月");var o=new Date(h,j,1),p=new Date(h,j+1,0);startDayBeforeToday=Math.ceil((l-o)/864e5)-1,c=Math.ceil((l-p)/864e5)-1,d=startDayBeforeToday+1,e=c>0?c:0}this.settings.onSelectChanged&&this.settings.onSelectChanged(d,e)},getDaysInMonth:function(a,b){var c=new Date(a,b,0);return c.getDate()},getWeeksInYear:function(a){var b=new Date(a.getFullYear(),0,1);return Math.ceil(((a-b)/864e5+b.getDay()+1)/7)},getWeeksStartDate:function(a,b){var c=new Date(a,0,1);return c.getTime()+7*(b-1)*864e5-864e5*(c.getDay()-1)}}),a.fn[f]=function(b){return this.each(function(){a.data(this,"plugin_"+f)||a.data(this,"plugin_"+f,new e(this,b))})}}(jQuery,window,document);